(function(){"use strict";var e=location.href.indexOf("debug-special-paywall")!=-1,a=(location.href.indexOf("hlg-special-paywall")!=-1,{getItem:function(e){return e?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},setItem:function(e,a,t,o,l,i){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var n="";if(t)switch(t.constructor){case Number:n=t===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+t;break;case String:n="; expires="+t;break;case Date:n="; expires="+t.toUTCString()}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(a)+n+(l?"; domain="+l:"")+(o?"; path="+o:"")+(i?"; secure":""),!0},removeItem:function(e,a,t){return!!this.hasItem(e)&&(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(t?"; domain="+t:"")+(a?"; path="+a:""),!0)},hasItem:function(e){return!!e&&new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),a=e.length,t=0;a>t;t++)e[t]=decodeURIComponent(e[t]);return e}}),t=function(){for(var e=1;e<arguments.length;e++)for(var a in arguments[e])arguments[e].hasOwnProperty(a)&&(arguments[0][a]=arguments[e][a]);return arguments[0]},o=function(){this.getParams(),this.productId=this.data&&this.data.product?this.data.product:909,this.siteId=this.data&&this.data.site?this.data.site:2,e&&console.log("[ debug special-paywall ] init - productId",this.productId),e&&console.log("[ debug special-paywall ] init - siteId",this.siteId),this.cookieName="lastSpecialCounted",this.getLibs()};return o.prototype.getParams=function(){e&&console.log("[ debug special-paywall ] getParams");var a=document.getElementById("special-paywall-js").src,t={};a.split("?").length>1&&a.split("?")[1].split("&").forEach(function(e){t[e.split("=")[0]]=e.split("=")[1]}),Object.keys(t).length>0&&(this.data=t),e&&console.log("[ debug special-paywall ] queryDict",t)},o.prototype.getLibs=function(){e&&console.log("[ debug special-paywall ] getLibs");var a=this,t=[];"function"!=typeof Paywall&&t.push({url:"https://www.rbsonline.com.br/cdn/scripts/paywall.min.js",id:"paywall-js"}),"function"!=typeof Wrs&&t.push({url:"https://www.rbsonline.com.br/cdn/scripts/wrs.min.js",id:"wrs-js"}),"function"!=typeof SocialLogin&&t.push({url:"https://www.rbsonline.com.br/cdn/scripts/social-login.min.js",id:"social-login-js"}),t.length>0&&this.loadJS(t,function(){setTimeout(function(){a.validate()},200)}),e&&console.log("[ debug special-paywall ] getLibs filesToLoad",t)},o.prototype.loadJS=function(e,a){var t=this,o=document.createElement("script"),l=e.shift();return o.type="application/javascript",o.src=l.url,o.id=l.id,o.async=!0,o.addEventListener("load",function(){e.length>0?t.loadJS(e,a):a&&a()}),document.body.appendChild(o),o},o.prototype.validate=function(){e&&console.log("[ debug special-paywall ] validate");var a=this;window.Wrs=Wrs.init(this.productId),window.SocialLoginJS=new SocialLogin({socialList:["facebook"]}),window.Wrs.getLoggedUser(function(o){e&&console.log("[ debug special-paywall ] validate getLoggedUser",o),window.Wrs.getUserInfo(function(l){e&&console.log("[ debug special-paywall ] validate getUserInfo",l),window.SocialLoginJS.checkLogin(o,function(i){e&&console.log("[ debug special-paywall ] validate checkLogin response data",o,i);var n=t(i,o);e&&console.log("[ debug special-paywall ] validate checkLogin d",n),a.checkCount(n,l)})})},function(e){a.checkCount({})})},o.prototype.checkCount=function(t,o){e&&console.log("[ debug special-paywall ] validate checkCount params user",t,o);var l=a.getItem(this.cookieName),i=location.href,n=/.phone.*html|\/([^\/])*html/g,s={},c=!1;this.paywall=new Paywall({site:this.siteId,product:this.productId}),t&&t.token&&(s.wrs=t.token),t&&t.socialLogged&&(s.socialLogged=t.socialLogged),i=i.replace(n,""),l=l&&""!=l?JSON.parse(l):{},c=t&&"STATUS_USER_AUTHENTICATED_USER_ACTIVE"===t.status,c&&l?l.lastSpecial&&l.lastSpecial!==i?this.getCount(s,i,o):l.lastSpecial&&(l.showLoginPaywall||l.showPaywall)&&this.getCount(s,i,o):this.getCount(s,i,o)},o.prototype.trackEvents=function(e,a,t){var o={login_paywall:"?signwall-identificacao=",closed_paywall:"?signwall-conteudo-especial=",paywall:"?paywall-wrs-nao-assinante=",social_paywall:"?paywall-social-nao-assinante=",social_fail_paywall:"?paywall-social-nao-assinante="},l=e&&(a||t)?document.location.pathname+o[e]:"";_gaq&&(a||t)&&""!==l&&_gaq.push(["_trackPageview",l])},o.prototype.getCount=function(t,o,l){e&&console.log("[ debug special-paywall ] getCount data , url , user",t,o,l);var i=this;this.paywall.view(t,function(t){e&&console.log("[ debug special-paywall ] getCount view data",l),e&&console.log("[ debug special-paywall ] getCount view response",t);var l={};if((t.showLoginPaywall||t.showPaywall)&&t.template){var n=new Date;n.setDate(n.getDate()+1);var s={product:i.productId,templateName:t.template,requestCPF:t.requestCPF},c="//gauchazh.clicrbs.com.br";if(e&&console.log("[ debug special-paywall ] getCount view config",s),e&&console.log("[ debug special-paywall ] getCount view that",i),t.showLoginPaywall)var p=c+"/login/specials/?redirectUri="+encodeURIComponent(o);else var p=c+"/login/specials/paywall?redirectUri="+encodeURIComponent(o);e&&console.log("[ debug special-paywall ] getCount urlGZH",p),e&&console.log("[ debug special-paywall ] getCount view that.template",i.template),l.template=t.template,l.showLoginPaywall=t.showLoginPaywall,l.showPaywall=t.showPaywall,e&&console.log("[ debug special-paywall ] getCount view data after",l),i.trackEvents(l.template,l.showPaywall,l.showLoginPaywall)}else l.showLoginPaywall=!1,l.showPaywall=!1;l.lastSpecial=o,a.setItem(i.cookieName,JSON.stringify(l),n,"/")})},new o}).call(this);